syntax = "proto3";

package obscura.client;

// ==============================================================================
// Client-to-Client Message Format
// This is the payload inside EncryptedMessage.content
// The server never sees or parses this - it's opaque bytes to the relay.
// ==============================================================================

message ClientMessage {
  enum Type {
    TEXT = 0;
    IMAGE = 1;
    FRIEND_REQUEST = 2;
    FRIEND_RESPONSE = 3;
    SESSION_RESET = 4;        // Request session re-establishment after key change
  }

  Type type = 1;
  string text = 2;              // Text content (for TEXT type, or caption for IMAGE)
  bytes image_data = 3;         // Raw image bytes (PNG/JPEG) - legacy inline mode
  string mime_type = 4;         // e.g., "image/png", "image/jpeg"
  uint64 timestamp = 5;         // Client-side timestamp (ms since epoch)
  uint32 display_duration = 6;  // How long to display message (seconds, default 8)
  string username = 7;          // Sender's username (for friend requests)
  bool accepted = 8;            // Response to friend request (true = accepted)
  string attachment_id = 9;     // UUID reference to uploaded attachment (replaces image_data)
  uint64 attachment_expires = 10; // When attachment expires (unix timestamp ms)

  // Session reset fields
  string reset_reason = 11;     // e.g., "decryption_failed", "key_mismatch"
  uint64 reset_timestamp = 12;  // When the reset was initiated
}
